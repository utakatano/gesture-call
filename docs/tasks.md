# 開発タスク履歴

## プロジェクト概要

Chrome拡張機能上でも使えるよう、CSPの制約を回避しつつWebカメラから手の動きを検知して任意のアクションが取れるジェスチャー認識システムの開発

## 完了済みタスク

### フェーズ1: Webアプリケーション版
- [x] ローカルサーバを起動してブラウザよりURLでアクセス
- [x] Webカメラに映った映像を全画面で表示
- [x] MediaPipe Hand Landmarkの統合
- [x] 手を挙げるジェスチャを検知して、「手を挙げました」とテキスト表示
- [x] 人差し指を上げるジェスチャを検知して、「人差し指を上げました」とテキスト表示
- [x] 親指を上げるジェスチャを検知して、「親指を上げました」とテキスト表示
- [x] リアルタイム手の描画（緑色の骨格線、赤いランドマーク）

### フェーズ2: Chrome拡張機能版
- [x] アドレスバーから拡張機能を選択したらポップアップの画面を表示
- [x] ポップアップの画面から、アクティブのタブで遷移するページURLやクリックするセレクタを指定可能
- [x] ポップアップの画面から、Webカメラを再生・停止ができる
- [x] Webカメラ再生時は、アクティブタブの右上に小さいサイズ(240px x 160px)で表示
- [x] CSP準拠のオフスクリーンドキュメント実装
- [x] Background Scriptによるメッセージルーティング
- [x] MediaPipe処理のオフスクリーン分離
- [x] Content Scriptでのカメラオーバーレイ表示
- [x] 手の描画機能（Chrome拡張機能版）
- [x] ジェスチャー検知間隔の最適化（500ms）

### フェーズ3: ドキュメント整備
- [x] README.mdの作成
- [x] アーキテクチャドキュメントの作成
- [x] インストールガイドの作成
- [x] 開発タスクの履歴整理

## 技術的実装詳細

### アーキテクチャ
- **Webアプリケーション版**: シンプルなフロントエンド実装
- **Chrome拡張機能版**: 4つのスクリプトによる分散アーキテクチャ
  - Background Script: メッセージルーティングハブ
  - Content Script: UI表示とアクション実行
  - Offscreen Document: MediaPipe処理エンジン
  - Popup Script: 設定画面とカメラ制御

### MediaPipe統合
- Hand Landmarkモデルによる21ポイント手の検知
- リアルタイム描画（緑色の骨格線、赤いランドマーク）
- CSP制約下での安全な実行

### ジェスチャー認識
- **手を挙げる**: 5本指全て立てる → URL遷移
- **人差し指**: 人差し指のみ → DOM要素クリック
- **親指**: 親指のみ → カスタムアクション

### パフォーマンス最適化
- フレーム処理間隔: 500ms（バランスの取れた応答性）
- 画像圧縮: JPEG 80%品質でデータ転送量削減
- 非同期メッセージング: UI応答性の維持

## 課題と解決策

### 1. CSP制約への対応
**課題**: Chrome拡張機能でMediaPipeが直接実行できない
**解決策**: オフスクリーンドキュメントでMediaPipe処理を分離

### 2. メッセージ通信の複雑性
**課題**: 4つのスクリプト間でのデータ同期
**解決策**: Background Scriptをハブとした集中型ルーティング

### 3. 手の描画が表示されない問題
**課題**: MediaPipe描画関数の読み込みタイミング
**解決策**: 非同期待機機能による確実な初期化

### 4. フレーム処理の応答性
**課題**: リアルタイム性とパフォーマンスのバランス
**解決策**: 500ms間隔での最適化と効率的なデータ転送

## 今後の改善予定

### 機能拡張
- [ ] より多様なジェスチャーパターンの対応（2本指、握り拳など）
- [ ] ジェスチャーの感度調整機能
- [ ] マルチハンド対応の強化
- [ ] カスタムアクションスクリプトの実行

### パフォーマンス改善
- [ ] 動的フレームレート調整
- [ ] MediaPipe設定の動的最適化
- [ ] メモリ使用量の最適化
- [ ] バッテリー消費の削減

### UI/UX改善
- [ ] カメラオーバーレイのカスタマイズ
- [ ] ジェスチャー学習モード
- [ ] 設定画面の拡張
- [ ] アクセシビリティ対応

### 開発者体験
- [ ] ホットリロード機能
- [ ] ユニットテストの追加
- [ ] CI/CDパイプラインの構築
- [ ] デバッグツールの強化

## 学習ポイント

### Chrome拡張機能開発
- Manifest V3の制約と対応方法
- オフスクリーンドキュメントの活用
- Content Security Policyの理解
- メッセージパッシングアーキテクチャ

### MediaPipe統合
- WebAssemblyベースライブラリの扱い
- リアルタイム画像処理の最適化
- 座標変換と描画ロジック
- ジェスチャー認識アルゴリズム

### TypeScript開発
- 型安全な非同期処理
- インターフェース設計
- エラーハンドリング
- モジュール化とコード構成
